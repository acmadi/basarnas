-- please apply_this_first.sql
USE db_asset_basarnas;

UPDATE ext_asset_angkutan SET kode_unor="44" WHERE kd_brg = "3020501005"; -- Pesawat

UPDATE asset_angkutan AS `a` INNER JOIN ext_asset_angkutan AS `b` ON `a`.`kd_lokasi`=`b`.`kd_lokasi` AND `a`.`kd_brg`=`b`.`kd_brg` AND `a`.`no_aset`=`b`.`no_aset`
SET `b`.`kd_klasifikasi_aset` = "020200" WHERE `a`.`merk` LIKE "%rescue%boat%" OR `a`.`type` LIKE "%rescue%boat%"; -- Recue boat selalu klasifikasinya 020200

UPDATE asset_angkutan AS `a` INNER JOIN ext_asset_angkutan AS `b` ON `a`.`kd_lokasi`=`b`.`kd_lokasi` AND `a`.`kd_brg`=`b`.`kd_brg` AND `a`.`no_aset`=`b`.`no_aset`
SET `b`.`kd_klasifikasi_aset` = "010100" WHERE `a`.`merk` LIKE "%rescue%truc%" OR `a`.`type` LIKE "%rescue%truc%"; -- Recue truck selalu klasifikasinya 010100

UPDATE asset_angkutan AS `a` INNER JOIN ext_asset_angkutan AS `b` ON `a`.`kd_lokasi`=`b`.`kd_lokasi` AND `a`.`kd_brg`=`b`.`kd_brg` AND `a`.`no_aset`=`b`.`no_aset`
SET `b`.`kd_klasifikasi_aset` = "010201" WHERE `a`.`merk` LIKE "%rescue%car%" OR `a`.`type` LIKE "%rescue%car%"; -- Recue car selalu klasifikasinya 010201

UPDATE asset_angkutan AS `a` INNER JOIN ext_asset_angkutan AS `b` ON `a`.`kd_lokasi`=`b`.`kd_lokasi` AND `a`.`kd_brg`=`b`.`kd_brg` AND `a`.`no_aset`=`b`.`no_aset`
SET `b`.`kode_unor` = "44" WHERE `b`.`kd_klasifikasi_aset` IN ("020200", "010100", "010201"); -- ketiga barang diatas selalu milik Sarpras

UPDATE ext_asset_alatbesar SET kode_unor = 44
WHERE (kd_lokasi, kd_brg, no_aset) IN (
	("107010199414370000KP","3010303002",1),
	("107010199414370000KP","3010303002",2),
	("107010199414370000KP","3010303002",3),
	("107010199414370000KP","3010303999",1),
	("107010199414370000KP","3010303999",2),
	("107010199414370000KP","3010303999",3),
	("107010199414370000KP","3010303999",4),
	("107010199414370000KP","3010310001",2),
	("107010199414370000KP","3010310001",3),
	("107010199414370000KP","3010310001",4),
	("107010199414370000KP","3010310999",2),
	("107010199414370000KP","3010310999",3),
	("107010199414370000KP","3010310999",4),
	("107010199414370000KP","3010310999",5),
	("107010199414370000KP","3010310999",6),
	("107010199414370000KP","3010310999",10),
	("107010199414370000KP","3010310999",11),
	("107010199414370000KP","3010310999",12),
	("107010199414370000KP","3010310999",13),
	("107010199414370000KP","3010310999",14),
	("107010199414370000KP","3010310999",15),
	("107010199414370000KP","3010310999",16),
	("107010199414370000KP","3010310999",17),
	("107010199414370000KP","3010310999",18),
	("107010199414370000KP","3010310999",19)
); 

INSERT INTO asset_alatbesar (kd_lokasi, kd_brg, no_aset, kuantitas, jns_trn, `type`, merk, kondisi, rph_aset, tgl_buku, tgl_prl, dari, dasar_hrg, no_kib)
(
	SELECT kd_lokasi, kd_brg, no_aset, kuantitas, jns_trn, keterangan, merk_type, kondisi, rph_aset, tgl_buku, tgl_perlh, asal_perlh, dsr_hrg, no_aset FROM t_masteru 
	WHERE (kd_lokasi, kd_brg, no_aset) IN (
		("107010199414370000KP","3030101029",19),
		("107010199414370000KP","3030101029",20),
		("107010199414370000KP","3030101029",21),
		("107010199414370000KP","3030101029",22),
		("107010199414370000KP","3030101029",23),
		("107010199414370000KP","3030101029",24),
		("107010199414370000KP","3030101029",25),
		("107010199414370000KP","3030101029",26),
		("107010199414370000KP","3030101029",27),
		("107010199414370000KP","3030101029",28),
		("107010199414370000KP","3030103001",89),
		("107010199414370000KP","3030103001",90),
		("107010199414370000KP","3030103001",91),
		("107010199414370000KP","3030103001",92),
		("107010199414370000KP","3030103001",93),
		("107010199414370000KP","3030103001",94),
		("107010199414370000KP","3030103001",95),
		("107010199414370000KP","3030103001",96),
		("107010199414370000KP","3030103001",97),
		("107010199414370000KP","3030103001",98),
		("107010199414370000KP","3030205002",14),
		("107010199414370000KP","3030205002",15),
		("107010199414370000KP","3030205002",16),
		("107010199414370000KP","3030205002",17),
		("107010199414370000KP","3050206034",3),
		("107010199414370000KP","3050206034",4),
		("107010199414370000KP","3050206034",5),
		("107010199414370000KP","3050206034",6),
		("107010199414370000KP","3060101085",15),
		("107010199414370000KP","3060101085",16),
		("107010199414370000KP","3060101085",17),
		("107010199414370000KP","3060101085",18),
		("107010199414370000KP","3060101085",19),
		("107010199414370000KP","3060101085",20),
		("107010199414370000KP","3060101085",21),
		("107010199414370000KP","3060101085",22),
		("107010199414370000KP","3060101085",23),
		("107010199414370000KP","3060101085",24),
		("107010199414370000KP","3060102012",1),
		("107010199414370000KP","3060102013",13),
		("107010199414370000KP","3060102013",14),
		("107010199414370000KP","3060102013",9),
		("107010199414370000KP","3060102127",3),
		("107010199414370000KP","3060102135",23),
		("107010199414370000KP","3060102135",24),
		("107010199414370000KP","3060347004",80),
		("107010199414370000KP","3060347004",81),
		("107010199414370000KP","3060347004",82),
		("107010199414370000KP","3060347004",83),
		("107010199414370000KP","3060347004",84),
		("107010199414370000KP","3060347004",85),
		("107010199414370000KP","3060347004",86),
		("107010199414370000KP","3060347004",87),
		("107010199414370000KP","3060347004",88),
		("107010199414370000KP","3060347004",89),
		("107010199414370000KP","3080115047",1),
		("107010199414370000KP","3080115047",2),
		("107010199414370000KP","3080115047",3),
		("107010199414370000KP","3080115047",4),
		("107010199414370000KP","3080115047",5),
		("107010199414370000KP","3080115047",6),
		("107010199414370000KP","3080115047",7),
		("107010199414370000KP","3080115047",8),
		("107010199414370000KP","3080115047",9),
		("107010199414370000KP","3150301020",580),
		("107010199414370000KP","3150301020",581),
		("107010199414370000KP","3150301020",582),
		("107010199414370000KP","3150301020",583),
		("107010199414370000KP","3150301020",584),
		("107010199414370000KP","3150301020",585),
		("107010199414370000KP","3150301020",586),
		("107010199414370000KP","3150301020",587),
		("107010199414370000KP","3150301020",588),
		("107010199414370000KP","3150301020",589),
		("107010199414370000KP","3150302999",657),
		("107010199414370000KP","3150302999",658),
		("107010199414370000KP","3150302999",634),
		("107010199414370000KP","3150302999",635),
		("107010199414370000KP","3150302999",636),
		("107010199414370000KP","3150302999",637),
		("107010199414370000KP","3150302999",638),
		("107010199414370000KP","3150302999",639),
		("107010199414370000KP","3150302999",640),
		("107010199414370000KP","3150302999",641),
		("107010199414370000KP","3150302999",642),
		("107010199414370000KP","3150302999",643),
		("107010199414370000KP","3150302999",644),
		("107010199414370000KP","3150302999",645),
		("107010199414370000KP","3150302999",646),
		("107010199414370000KP","3150302999",647),
		("107010199414370000KP","3150302999",648),
		("107010199414370000KP","3150302999",649),
		("107010199414370000KP","3150302999",650),
		("107010199414370000KP","3150302999",651),
		("107010199414370000KP","3150302999",652),
		("107010199414370000KP","3150302999",653)
	) 
	AND (kd_lokasi, kd_brg, no_aset) NOT IN (
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_alatbesar
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_angkutan
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_bangunan
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_dil
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_perairan
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_ruang
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_senjata
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM asset_tanah
	)
	AND LEFT(jns_trn,1)="1"
);

INSERT INTO ext_asset_alatbesar (kd_lokasi, kd_brg, no_aset, kode_unor)
(
	SELECT kd_lokasi, kd_brg, no_aset, 44 AS `kode_unor` FROM t_masteru 
	WHERE (kd_lokasi, kd_brg, no_aset) IN (
		("107010199414370000KP","3030101029",19),
		("107010199414370000KP","3030101029",20),
		("107010199414370000KP","3030101029",21),
		("107010199414370000KP","3030101029",22),
		("107010199414370000KP","3030101029",23),
		("107010199414370000KP","3030101029",24),
		("107010199414370000KP","3030101029",25),
		("107010199414370000KP","3030101029",26),
		("107010199414370000KP","3030101029",27),
		("107010199414370000KP","3030101029",28),
		("107010199414370000KP","3030103001",89),
		("107010199414370000KP","3030103001",90),
		("107010199414370000KP","3030103001",91),
		("107010199414370000KP","3030103001",92),
		("107010199414370000KP","3030103001",93),
		("107010199414370000KP","3030103001",94),
		("107010199414370000KP","3030103001",95),
		("107010199414370000KP","3030103001",96),
		("107010199414370000KP","3030103001",97),
		("107010199414370000KP","3030103001",98),
		("107010199414370000KP","3030205002",14),
		("107010199414370000KP","3030205002",15),
		("107010199414370000KP","3030205002",16),
		("107010199414370000KP","3030205002",17),
		("107010199414370000KP","3050206034",3),
		("107010199414370000KP","3050206034",4),
		("107010199414370000KP","3050206034",5),
		("107010199414370000KP","3050206034",6),
		("107010199414370000KP","3060101085",15),
		("107010199414370000KP","3060101085",16),
		("107010199414370000KP","3060101085",17),
		("107010199414370000KP","3060101085",18),
		("107010199414370000KP","3060101085",19),
		("107010199414370000KP","3060101085",20),
		("107010199414370000KP","3060101085",21),
		("107010199414370000KP","3060101085",22),
		("107010199414370000KP","3060101085",23),
		("107010199414370000KP","3060101085",24),
		("107010199414370000KP","3060102012",1),
		("107010199414370000KP","3060102013",13),
		("107010199414370000KP","3060102013",14),
		("107010199414370000KP","3060102013",9),
		("107010199414370000KP","3060102127",3),
		("107010199414370000KP","3060102135",23),
		("107010199414370000KP","3060102135",24),
		("107010199414370000KP","3060347004",80),
		("107010199414370000KP","3060347004",81),
		("107010199414370000KP","3060347004",82),
		("107010199414370000KP","3060347004",83),
		("107010199414370000KP","3060347004",84),
		("107010199414370000KP","3060347004",85),
		("107010199414370000KP","3060347004",86),
		("107010199414370000KP","3060347004",87),
		("107010199414370000KP","3060347004",88),
		("107010199414370000KP","3060347004",89),
		("107010199414370000KP","3080115047",1),
		("107010199414370000KP","3080115047",2),
		("107010199414370000KP","3080115047",3),
		("107010199414370000KP","3080115047",4),
		("107010199414370000KP","3080115047",5),
		("107010199414370000KP","3080115047",6),
		("107010199414370000KP","3080115047",7),
		("107010199414370000KP","3080115047",8),
		("107010199414370000KP","3080115047",9),
		("107010199414370000KP","3150301020",580),
		("107010199414370000KP","3150301020",581),
		("107010199414370000KP","3150301020",582),
		("107010199414370000KP","3150301020",583),
		("107010199414370000KP","3150301020",584),
		("107010199414370000KP","3150301020",585),
		("107010199414370000KP","3150301020",586),
		("107010199414370000KP","3150301020",587),
		("107010199414370000KP","3150301020",588),
		("107010199414370000KP","3150301020",589),
		("107010199414370000KP","3150302999",657),
		("107010199414370000KP","3150302999",658),
		("107010199414370000KP","3150302999",634),
		("107010199414370000KP","3150302999",635),
		("107010199414370000KP","3150302999",636),
		("107010199414370000KP","3150302999",637),
		("107010199414370000KP","3150302999",638),
		("107010199414370000KP","3150302999",639),
		("107010199414370000KP","3150302999",640),
		("107010199414370000KP","3150302999",641),
		("107010199414370000KP","3150302999",642),
		("107010199414370000KP","3150302999",643),
		("107010199414370000KP","3150302999",644),
		("107010199414370000KP","3150302999",645),
		("107010199414370000KP","3150302999",646),
		("107010199414370000KP","3150302999",647),
		("107010199414370000KP","3150302999",648),
		("107010199414370000KP","3150302999",649),
		("107010199414370000KP","3150302999",650),
		("107010199414370000KP","3150302999",651),
		("107010199414370000KP","3150302999",652),
		("107010199414370000KP","3150302999",653)
	) 
	AND (kd_lokasi, kd_brg, no_aset) NOT IN (
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_alatbesar
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_angkutan
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_bangunan
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_dil
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_perairan
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_ruang
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_senjata
		UNION
		SELECT kd_lokasi, kd_brg, no_aset FROM ext_asset_tanah
	)
	AND LEFT(jns_trn,1)="1"
);

